# Story E13.1 — Parent Issue Selection in Create Issue Dialog

**Epic:** E13 — Issue Hierarchy & Linkage
**Status:** Done
**Priority:** High

---

## Story

Como usuário do FlowBoard,
Quero selecionar um issue pai ao criar um novo issue (Story, Task, Subtask),
Para que a hierarquia Epic → Story → Task → Subtask seja mantida corretamente.

---

## Contexto

Atualmente o `CreateIssueDialog` cria issues sem permitir vincular um pai. O backend já aceita `parent_id` no `CreateIssueRequest`. A hierarquia esperada é:

- **Epic** → sem pai (raiz do projeto)
- **Story** → pai obrigatório: Epic
- **Task** / **Bug** → pai opcional: Story ou Epic
- **Subtask** → pai obrigatório: Task

---

## Acceptance Criteria

### AC1 — Seletor de pai adaptativo por tipo
- Quando `type = "story"`, exibir select "Parent Epic" com todos os Epics do projeto
- Quando `type = "task"` ou `type = "bug"`, exibir select "Parent Story" (opcional) com Stories do projeto
- Quando `type = "subtask"`, exibir select "Parent Task" (obrigatório) com Tasks do projeto
- Quando `type = "epic"`, nenhum seletor de pai é exibido

### AC2 — Dados do seletor
- O seletor exibe `{issue.key} — {issue.title}` para cada opção
- A lista é carregada via `useIssues(projectId)` filtrada pelo tipo correto
- O seletor tem opção "None" (sem pai) para tipos opcionais (task, bug)

### AC3 — Persistência
- O `parent_id` selecionado é incluído no payload de `CreateIssueRequest`
- Após criação, o issue aparece agrupado sob o pai correto no BacklogPage

### AC4 — UX
- O seletor não aparece durante o loading inicial dos issues
- Mensagem de placeholder: "Select parent {type}..."
- Select usa o padrão Radix `value="__none__"` para opção vazia (sem `value=""`)

---

## Dev Notes

**Arquivos a modificar:**
- `frontend/src/components/issues/CreateIssueDialog.tsx` — adicionar select de pai condicional
- `frontend/src/hooks/useIssues.ts` — já disponível, usar `useIssues(projectId)` com filtro por tipo

**Lógica do seletor:**
```tsx
// Dentro de CreateIssueDialog, após carregar issues do projeto:
const parentCandidates = useMemo(() => {
  if (formData.type === 'story') return issues.filter(i => i.type === 'epic');
  if (formData.type === 'task' || formData.type === 'bug') return issues.filter(i => i.type === 'story');
  if (formData.type === 'subtask') return issues.filter(i => i.type === 'task');
  return [];
}, [issues, formData.type]);
```

**IMPORTANTE:** Usar `value="__none__"` para opção vazia no Select do Radix UI (nunca `value=""`).

---

## Tasks

- [x] 1. Adicionar `useIssues(projectId)` dentro do `CreateIssueDialog` para buscar issues do projeto
- [x] 2. Criar lógica `parentCandidates` baseada no tipo selecionado
- [x] 3. Renderizar select de pai condicional no formulário
- [x] 4. Incluir `parent_id` no `formData` e no payload de criação
- [x] 5. Resetar `parent_id` quando o tipo do issue muda
- [x] 6. Testar: criar Story vinculada a Epic → aparece agrupada no Backlog
- [x] 7. Testar: criar Subtask vinculada a Task → aparece no nível correto

---

## Dev Agent Record

**Agent Model Used:** Claude Opus 4.6
**Completion Notes:** All 4 ACs implemented. Parent selector is adaptive per issue type, uses `useIssues` hook with `{ size: 500 }` to fetch project issues, filters by type via `useMemo`, resets `parent_id` on type change, uses `value="__none__"` for optional empty selection, disables submit when required parent is missing. Zero new lint/type errors introduced.
**File List:**
- `flowboard/frontend/src/components/issues/CreateIssueDialog.tsx` (modified)
- `flowboard/docs/stories/E13.1-parent-issue-selection.md` (updated)
**Change Log:**
- Added `useMemo` import and `useIssues`, `IssueType` imports
- Added `parentConfig` memo that returns label, filterType, and required flag based on `formData.type`
- Added `parentCandidates` memo filtering issues by parent type
- Added conditional parent Select component between Type and Title fields
- Reset `parent_id` to `undefined` when type changes
- Disabled submit button when required parent is not selected
