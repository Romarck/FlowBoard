# Story E14.1 — Sprint Creation Fix (Page Refresh)

**Epic:** E14 — Sprint Planning & Issue Assignment
**Status:** Ready for Dev
**Priority:** High

---

## Story

Como usuário do FlowBoard,
Quero que a lista de sprints atualize automaticamente após criar uma sprint,
Para não precisar recarregar a página manualmente.

---

## Contexto

O `CreateSprintDialog` usa `DialogTrigger` do Radix UI e chama `useCreateSprint`. O hook de criação não invalida o cache React Query após sucesso, então a lista de sprints (`useSprints`) não refaz a busca e a sprint criada não aparece na tela.

Adicionalmente, `SprintPage` lê `useIssues(projectId)` e desestrutura `data` diretamente como array, mas `useIssues` retorna `{ items: [], total: 0 }` — isso causa um erro silencioso ao chamar `.filter()` sobre o objeto.

---

## Acceptance Criteria

### AC1 — Refresh automático após criação
- Após criar uma sprint com sucesso, a lista de sprints na `SprintPage` atualiza sem F5
- O `useCreateSprint` deve chamar `qc.invalidateQueries({ queryKey: sprintKeys.byProject(projectId) })` no `onSuccess`

### AC2 — Leitura correta dos issues na SprintPage
- `useIssues` retorna `{ data: { items, total } }` — a SprintPage deve ler `data?.items ?? []`
- `issuesBySprint(sprintId)` filtra sobre o array correto

### AC3 — Sprint aparece na categoria correta
- Sprint recém-criada aparece na seção "Planning" (status padrão = `planning`)
- Sprint card exibe nome, datas e goal corretamente

---

## Dev Notes

**Arquivos a modificar:**
- `frontend/src/hooks/useSprints.ts` — adicionar `invalidateQueries` no `useCreateSprint`
- `frontend/src/pages/sprints/SprintPage.tsx` — corrigir leitura de `allIssues`

**Fix no hook:**
```ts
// useSprints.ts — useCreateSprint
onSuccess: () => {
  qc.invalidateQueries({ queryKey: sprintKeys.byProject(projectId) });
}
```

**Fix na SprintPage:**
```tsx
// antes:
const { data: allIssues = [] } = useIssues(projectId);
// depois:
const { data: issuesData } = useIssues(projectId);
const allIssues = issuesData?.items ?? [];
```

---

## Tasks

- [x] 1. Verificar implementação atual do `useCreateSprint` em `useSprints.ts`
- [x] 2. Adicionar `invalidateQueries` no `onSuccess` do `useCreateSprint`
- [x] 3. Corrigir leitura de `allIssues` na `SprintPage` (usar `data?.items ?? []`)
- [x] 4. Testar: criar sprint → aparece imediatamente na lista sem F5
- [x] 5. Testar: issues com `sprint_id` aparecem agrupados no card correto

---

## Dev Agent Record

**Agent Model Used:** Claude Opus 4.6
**Completion Notes:** AC1 was already implemented (invalidateQueries present in useCreateSprint). AC2 fixed by changing SprintPage to read `issuesData?.items ?? []` instead of destructuring data directly as array. AC3 verified -- sprint status defaults to 'planning' and the page groups by status correctly.
**File List:**
- `flowboard/frontend/src/pages/sprints/SprintPage.tsx` (modified)
- `flowboard/frontend/src/hooks/useSprints.ts` (verified, already correct)
**Change Log:**
- SprintPage.tsx: Changed `const { data: allIssues = [] } = useIssues(projectId)` to `const { data: issuesData } = useIssues(projectId); const allIssues = issuesData?.items ?? [];` to properly unwrap the paginated response shape `{ items, total, page, size }`.
